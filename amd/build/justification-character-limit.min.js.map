{"version":3,"file":"justification-character-limit.min.js","sources":["../src/justification-character-limit.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Justification character limit.\n *\n * @copyright  2019 Coventry University\n * @author     Frédéric Massart <fred@branchup.tech>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery', 'core/str', 'core/notification'], function($, Str, Notification) {\n\n    const WRAPPER_CLASS = 'justification-character-limit-wrapper';\n    const WRAPPER_SELECTOR = '.justification-character-limit-wrapper';\n    const TEXT_CLASS = 'justification-character-limit';\n    const TEXT_SELECTOR = '.justification-character-limit';\n\n    /**\n     * Update character limit.\n     *\n     * @param {Node} textareaNode The text area.\n     * @param {Number} limit The limit.\n     */\n    function updateCharacterLimit(textareaNode, limit) {\n        const node = $(textareaNode);\n        const length = [...node.val()].length; // Character-friendly length.\n        const remaining = limit - length;\n        const sibling = node.siblings(WRAPPER_SELECTOR);\n        const textNode = sibling.find(TEXT_SELECTOR);\n\n        textNode.text(M.util.get_string('charactersremaining', 'mod_peerwork', remaining));\n        if (remaining < 0) {\n            textNode.addClass('text-danger');\n        } else {\n            textNode.removeClass('text-danger');\n        }\n    }\n\n    /**\n     * Justification character limit.\n     *\n     * @param {String} selector The textarea selector.\n     * @param {Number} limit The limit.\n     */\n    function init(selector, limit) {\n        if (!limit) {\n            return;\n        }\n\n        Str.get_string('charactersremaining', 'mod_peerwork').then(() => {\n\n            const textareaNodes = $(selector);\n\n            // Append the place where we'll compute the character limit.\n            textareaNodes.each(function(i, n) {\n                var node = $(n);\n                node.after(`<div class=\"${WRAPPER_CLASS}\"><small class=\"${TEXT_CLASS}\"></small></div>`);\n                updateCharacterLimit(n, limit);\n            });\n\n            // Add the change listener.\n            textareaNodes.on('keyup', function(e) {\n                updateCharacterLimit(e.target, limit);\n            });\n\n            return null;\n\n        }).catch(Notification.exception);\n    }\n\n    return {\n        init: init\n    };\n\n});\n"],"names":["define","$","Str","Notification","updateCharacterLimit","textareaNode","limit","node","remaining","val","length","textNode","siblings","find","text","M","util","get_string","addClass","removeClass","init","selector","then","textareaNodes","each","i","n","after","on","e","target","catch","exception"],"mappings":";;;;;;;AAuBAA,oDAAO,CAAC,SAAU,WAAY,sBAAsB,SAASC,EAAGC,IAAKC,uBAaxDC,qBAAqBC,aAAcC,aAClCC,KAAON,EAAEI,cAETG,UAAYF,MADH,IAAIC,KAAKE,OAAOC,OAGzBC,SADUJ,KAAKK,SAdA,0CAeIC,KAbP,kCAelBF,SAASG,KAAKC,EAAEC,KAAKC,WAAW,sBAAuB,eAAgBT,YACnEA,UAAY,EACZG,SAASO,SAAS,eAElBP,SAASQ,YAAY,qBAoCtB,CACHC,cA3BUC,SAAUf,OACfA,OAILJ,IAAIe,WAAW,sBAAuB,gBAAgBK,MAAK,WAEjDC,cAAgBtB,EAAEoB,iBAGxBE,cAAcC,MAAK,SAASC,EAAGC,GAChBzB,EAAEyB,GACRC,4BA5CK,mEAEH,qDA2CPvB,qBAAqBsB,EAAGpB,UAI5BiB,cAAcK,GAAG,SAAS,SAASC,GAC/BzB,qBAAqByB,EAAEC,OAAQxB,UAG5B,QAERyB,MAAM5B,aAAa6B"}