{"version":3,"file":"revised-grades-total-calculator.min.js","sources":["../src/revised-grades-total-calculator.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Revised grades total calculator.\n *\n * @copyright  2019 Coventry University\n * @author     Frédéric Massart <fred@branchup.tech>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery'], function($) {\n\n    /**\n     * Revised grades total calculator.\n     *\n     * @param {String} tableSelector The table selector.\n     */\n    function revisedGradesTotalCalculator(tableSelector) {\n        var tableNode = $(tableSelector);\n        var fieldNodes = tableNode.find('input[name^=\"grade_\"]');\n        var totalNode = tableNode.find('.total-revised-grade');\n\n        var getRevisedTotal = () => {\n            let total = null;\n            fieldNodes.each(function(i, field) {\n                var node = $(field);\n                var value = parseFloat(node.val().replace(',', '.')); // Minor handling of formatted values.\n                if (!value || isNaN(value)) {\n                    return;\n                }\n                total = (total || 0) + value;\n            });\n            return total;\n        };\n\n        var updateTotal = () => {\n            var loadedTotal = getRevisedTotal();\n            if (loadedTotal !== null) {\n                totalNode.text(loadedTotal.toFixed(2));\n            } else {\n                totalNode.text('');\n            }\n        };\n\n        fieldNodes.on('change', function() {\n            updateTotal();\n        });\n\n        updateTotal();\n    }\n\n    return {\n        init: revisedGradesTotalCalculator\n    };\n\n});\n"],"names":["define","$","init","tableSelector","tableNode","fieldNodes","find","totalNode","updateTotal","loadedTotal","total","each","i","field","node","value","parseFloat","val","replace","isNaN","getRevisedTotal","text","toFixed","on"],"mappings":";;;;;;;AAuBAA,sDAAO,CAAC,WAAW,SAASC,SAyCjB,CACHC,cAnCkCC,mBAC9BC,UAAYH,EAAEE,eACdE,WAAaD,UAAUE,KAAK,yBAC5BC,UAAYH,UAAUE,KAAK,wBAe3BE,YAAc,SACVC,YAdc,UACdC,MAAQ,YACZL,WAAWM,MAAK,SAASC,EAAGC,WACpBC,KAAOb,EAAEY,OACTE,MAAQC,WAAWF,KAAKG,MAAMC,QAAQ,IAAK,MAC1CH,QAASI,MAAMJ,SAGpBL,OAASA,OAAS,GAAKK,UAEpBL,OAIWU,GACE,OAAhBX,YACAF,UAAUc,KAAKZ,YAAYa,QAAQ,IAEnCf,UAAUc,KAAK,KAIvBhB,WAAWkB,GAAG,UAAU,WACpBf,iBAGJA"}